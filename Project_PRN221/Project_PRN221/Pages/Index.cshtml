@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
            //var special = Model.ListProducts.Where(p => p.CategoryId == 2);
    //var standard = Model.ListProducts.Where(p => p.CategoryId == 1);
    //int pageNum = (int)ViewData["CurentPage"];
    //int total = (int)ViewData["TotalPage"];
    //int next = pageNum + 1;
    //int prev = pageNum - 1;
}
@*<section class="page-info set-bg" >
    <div class="section-header">
        <h1 class="text-white">Menu</h1>
        <span>~ Delicious food ~</span>
    </div>
</section>*@
@using System.Security.Claims;

<!-- SHOP LIST -->
<section class="section-primary pt-150 pb-113 shop-list">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <a href="documents/create" class="btn btn-primary">
                    Thêm Văn bản
                </a>
               

                <div class="sorting">
                    <div class="woocommerce-result-count font-weight-bold" style="font-family: Merriweather;font-size: 40px;">
                        Tìm kiếm văn bản

                    </div>
                    <form method="get" class="woocommerce-ordering">
                        <table>
                            <tr>
                                <td>
                                    <span>Văn bản số</span>
                                    <div class="widget_search">
                                        <input class="form-control" type="text" name="search" id="txtSearch" placeholder="Enter document name to search" value="@ViewData["txtSearch"]">
                                    </div>
                                </td>
                                <td>
                                    <span>Loại văn bản</span>
                                    <div class="form-holder">
                                        <select id="sortSelect1" name="orderby" class="orderby form-control" style="width:100%">
                                            <option value="">Thể loại</option>
                                            <option value="asc">All</option>
                                        </select>
                                    </div>
                                </td>
                                <td>
                                    <span>Người ký văn bản</span>
                                    <div class="form-holder">
                                        <div class="widget_search">
                                            <input class="form-control" type="text" name="search" id="txtSearch" placeholder="Enter document name to search" value="@ViewData["txtSearch"]">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span>Từ ngày</span>
                                    <div class="form-holder">
                                        <div class="widget_search">
                                            <input class="form-control" type="date" name="search" id="txtSearch" placeholder="Enter document name to search" value="@ViewData["txtSearch"]">
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span>Đến ngày</span>
                                    <div class="form-holder">
                                        <div class="widget_search">
                                            <input class="form-control" type="date" name="search" id="txtSearch" placeholder="Enter document name to search" value="@ViewData["txtSearch"]">
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span>Người tạo</span>
                                    <div class="widget_search">
                                        <input class="form-control" type="text" name="search" id="txtSearch" placeholder="Enter document name to search" value="@ViewData["txtSearch"]">
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span>Title</span>
                                    <div class="widget_search">
                                        <input class="form-control" type="text" name="search" id="txtSearch" placeholder="Enter document name to search" value="@ViewData["txtSearch"]">
                                    </div>
                                </td>
                                <td colspan="3">
                                    <div class="form-holder" style=" margin-top: 20px;width:100%">
                                        <input type="submit" class="woocommerce-Button button au-btn round has-bg" name="login" value="Tìm kiếm">
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </form>
                </div>

                <div class="row products">
                    <table class="table search-result" cellspacing="0" rules="all" border="1" id="ctrl_191017_163_grvDocument" style="border-style:None;width:100%;border-collapse:collapse;">
                            <tr>
                                <th class="CodeClass" scope="col">Số ký hiệu</th>
                                <th scope="col">Ngày ban hành</th>
                                <th scope="col">Trích yếu</th>
                                <th scope="col">Người ký</th>
                            </tr>
                        <tbody id="table">

                            @foreach (var item in Model.ListDocument)
                            {
                                <tr>
                                    <td>
                                        <a href="#">
                                            <span class="code">@item.DocumentNumber</span>
                                        </a>
                                    </td>
                                    <td>
                                        <span>@item.CreateDate</span>
                                    </td>
                                    <td>
                                        <span class="substract">V/v chuyển mục đích sử dụng đất trồng lúa sang mục đích khác để thực hiện Dự án Đường kết nối đê bao ven biển với cầu Thứ Ba tại huyện An Biên, tỉnh Kiên Giang</span>
                                        <div class="bl-doc-files">
                                            <div class="bl-doc-file"><a href="https://datafiles.chinhphu.vn/cpp/files/vbpq/2023/12/1275-nn.signed.pdf" target="_blank" download="">Tài liệu đính kèm</a></div>
                                        </div>
                                    </td>
                                    <td>
                                        <span>@item.HumanSign</span>
                                    </td>
                                </tr>
                            }
                            </tbody>
                    </table>
                    @*@if (Model.Product.Count < 1)
                    {
                    @ViewData["NoProduct"]
                    }
                    @foreach (var items in Model.Product)
                    {
                    <div class="col-md-6 col-lg-4">
                    <div class="item">
                    <div class="thumb">
                    <a asp-page="/products/detail" asp-route-id="@items.Id" class="woocommerce-LoopProduct-link woocommerce-loop-product__link">
                    <img src="@Url.Content(items.Image)" alt="" style="width: 100px;">
                    </a>
                    <a asp-page="/tasks/shop_cart" asp-page-handler="buy" asp-route-id="@items.Id" class="button product_type_simple add_to_cart_button ajax_add_to_cart">Add to cart</a>
                    </div>
                    <div class="info">
                    <h5 class="woocommerce-loop-product__title">
                    <a asp-page="/products/detail" asp-route-id="@items.Id">@items.ProductName</a>
                    </h5>
                    <div class="star-rating">
                    <i class="zmdi zmdi-star"></i>
                    <i class="zmdi zmdi-star"></i>
                    <i class="zmdi zmdi-star"></i>
                    <i class="zmdi zmdi-star"></i>
                    <i class="zmdi zmdi-star-outline"></i>
                    </div>
                    <span class="price">
                    <span class="woocommerce-Price-amount amount">
                    <span class="woocommerce-Price-currencySymbol">$</span>@String.Format("{0:.##}", items.Price)
                    </span>
                    </span>
                    </div>
                    </div>
                    </div>
                    }*@
                </div>
                <div class="woocommerce-pagination">
                    @*<ul class="page-numbers">
                    <li>
                    @if (pageNum == 1)
                    {
                    <a href="/products/menu?PageNum=@prev" hidden="hidden" class="page-numbers prev">
                    <span class="lnr lnr-arrow-left"></span>
                    </a>
                    }
                    else
                    {
                    <a href="/products/menu?PageNum=@prev" class="page-numbers prev">
                    <span class="lnr lnr-arrow-left"></span>
                    </a>
                    }
                    </li>
                    @for (var i = 1; i <= total; i++)
                    {
                    @if (pageNum == i)
                    {
                    <li>
                    <span class="page-numbers current"><a href="/products/menu?PageNum=@i">@i</a></span>
                    </li>
                    }
                    else
                    {
                    <li>
                    <a href="/products/menu?PageNum=@i" class="page-numbers inactive">@i</a>
                    </li>
                    }
                    }
                    <li>
                    @if (pageNum == total)
                    {
                    <a href="/products/menu?PageNum=@next" hidden="hidden" class="page-numbers next">
                    <span class="lnr lnr-arrow-right"></span>
                    </a>
                    }
                    else
                    {
                    <a href="/products/menu?PageNum=@next" class="page-numbers next">
                    <span class="lnr lnr-arrow-right"></span>
                    </a>
                    }
                    </li>
                    </ul>*@
                </div>
            </div>
            @* <div class="col-md-3">
            <div class="sidebar">
            <!-- SEARCH -->
            <div class="widgets widget_search">
            <form method="get" class="search-form">
            <input class="form-control" type="text" name="search" id="txtSearch" placeholder="Enter document name to search" value="@ViewData["txtSearch"]">
            <button class="search-icon" id="btnSearch">
            <span class="lnr lnr-magnifier"></span>
            </button>
            </form>
            </div>
            </div>
            </div>*@
        </div>
    </div>
</section>

<script src="~/js/signalr/dist/browser/signalr.js"></script>
<script type="text/javascript">
    var connection = new signalR.HubConnectionBuilder().withUrl("/signalrServer").build();
    connection.start()
        .then(function () {
            console.log('SignalR đã kết nối thành công');
        })
        .catch(function (err) {
            console.error('SignalR đã kết nối thất bại');
        });
    connection.onclose(function (error) {
        console.log('SignalR kết nối đã đóng với lỗi: ' + error);
    });

    connection.on("LoadCreateDocs", function (Id) {
        console.log('Sự kiện "LoadCreateDocs" đã được gọi');
        var userId = @User.FindFirstValue("AccountId");
        if (userId === Id) {
            LoadCreate();
        }
    });

    function LoadCreate() {
        console.log(`Hàm "LoadCreate" đã được gọi`);
        var rc = ``;
        // Tạo một đối tượng chứa các thông số bạn muốn truyền vào
        // Gọi hàm POST bằng AJAX
        $.ajax({
            type: 'POST',
            url: '/?handler=Async',
            contentType: 'application/json',
            headers: {
                "RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
            },
            success: function (data) {
                // Xử lý dữ liệu trả về ở đây
                $.each(data, (k, v) => {
                    rc += `<tr>
                            <td>
                                <a href="#">
                                    <span class="code">${v.DocumentNumber}</span>
                                </a>
                            </td>
                            <td>
                                    <span>${ v.CreateDate } </span>
                            </td>
                            <td>
                                <span class="substract">V/v chuyển mục đích sử dụng đất trồng lúa sang mục đích khác để thực hiện Dự án Đường kết nối đê bao ven biển với cầu Thứ Ba tại huyện An Biên, tỉnh Kiên Giang</span>
                                <div class="bl-doc-files">
                                    <div class="bl-doc-file"><a href="https://datafiles.chinhphu.vn/cpp/files/vbpq/2023/12/1275-nn.signed.pdf" target="_blank" download="">Tài liệu đính kèm</a></div>
                                </div>
                            </td>
                            <td>
                                    <span>${ v.HumanSign } </span>
                            </td>
                        </tr>`;
                })
                // Xử lý dữ liệu trả về ở đây
                console.log(response);
                $("#table").html(rc);
                console.log("Đồng bộ văn bản thành công");
            },
            error: function (jqXHR, textStatus, errorThrown) {
                // Xử lý lỗi ở đây
                alert(jqXHR.status);
                alert(errorThrown);
            }
        });
    }
</script>